<!doctypehtml>
<html lang=en-us>
<head>
	<meta charset=utf-8>
	<meta content="text/html; charset=utf-8"http-equiv=Content-Type>
	<title>Wallycore shell</title>
	<style>
		textarea{
			font-family:monospace;width:80%;padding-right:0;margin-left:auto;
			margin-right:auto;display:block
		}
	</style>
</head>
<body>
	<textarea id="output" rows="20"></textarea>
	<script>
		let element =document.getElementById("output");
		let log = (...args)=>{
			element.value += `${args.join(" ")}\n--------------------------------------\n`;
		}
		let wally_example = ()=>{
			log("wally_init ... ", ccall("wally_init","number",["number"],[0]));

			let e=new Uint8Array(32);
			window.crypto.getRandomValues(e),
			log("wally_secp_randomize ... ", ccall("wally_secp_randomize","number",["array","number"],[e,e.length]));

			let l=new Uint8Array(40);
			window.crypto.getRandomValues(l);
			let n=Module._malloc(32);
			log(
				"bip39_mnemonic_from_bytes ... ",
				ccall(
					"bip39_mnemonic_from_bytes","number",
					["number","array","number","number"],
					[null,l,l.length,n]
				)
			);

			let mnemonics = UTF8ToString(getValue(n, "*")).split(" ");
			log("mnemonic ("+mnemonics.length+")", mnemonics.join(" "));

			let seeds=new Uint8Array(512);
			let written=Module._malloc(10);
			log("bip39_mnemonic_to_seed", 
				ccall("wally_free_string","number",
					["array", "array", "array", "number", "number"],
					[n, null, seeds, 5, written]
				))

			log("wally_free_string ... ", ccall("wally_free_string","number",["number"],[n]));
			Module._free(n);
		};

		var Module={
			preRun:[],
			postRun:[wally_example]
		}
	</script>
	<script async src="wallycore.js">
	</script>
</body>
</html>